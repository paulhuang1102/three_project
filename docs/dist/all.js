'use strict';

var scene = void 0,
    camera = void 0,
    renderer = void 0,
    clock = void 0,
    deltaTime = void 0,
    light = void 0,
    particleSystem = void 0,
    rocket = void 0;

var width = void 0,
    height = void 0;

var keyboard = {};

var init = function init() {
    window.addEventListener('resize', onResize, false);

    clock = new THREE.Clock(true);
    scene = new THREE.Scene();
    renderer = new THREE.WebGLRenderer();

    width = window.innerWidth;
    height = window.innerHeight;

    renderer.setSize(width, height);

    document.getElementById('map').appendChild(renderer.domElement);
    camera = new THREE.PerspectiveCamera(70, width / height, 1, 1000);
    camera.position.z = 100;

    light = new THREE.DirectionalLight(0xffffff);
    light.position.set(0, 0, 1);
    scene.add(light);

    particleSystem = createParticleSystem();
    scene.add(particleSystem);

    var mtlLoader = new THREE.MTLLoader();

    mtlLoader.load('../assets/obj/rocket-launcher.mtl', function (mat) {
        mat.preload();
        var objLoader = new THREE.OBJLoader();

        objLoader.setMaterials(mat);
        objLoader.load('../assets/obj/rocket-launcher.obj', function (mesh) {
            rocket = new THREE.Object3D();

            var pilot = new THREE.Mesh(new THREE.CircleGeometry(5, 32), new THREE.MeshBasicMaterial({
                map: new THREE.TextureLoader().load('../assets/img/oreo.png')
            }));
            pilot.position.y = 15;
            pilot.position.x = -5;
            mesh.scale.set(10, 10, 10);
            mesh.rotation.z = Math.PI / 2;
            mesh.rotation.y = Math.PI;
            rocket.add(pilot);
            rocket.add(mesh);
            scene.add(rocket);
        });
    });

    // createRocket();
    animate();
};

var forward = function forward() {
    if (rocket.rotation.z !== 0) {
        requestAnimationFrame(forward);
        if (rocket.rotation.z > 0) {
            rocket.rotation.z -= Math.PI / 16;
        }

        if (rocket.rotation.z < 0) {
            rocket.rotation.z += Math.PI / 16;
        }
    }
};

var animate = function animate() {
    deltaTime = clock.getDelta();

    // control rocket

    if (keyboard[38]) {
        //up key
        rocket.rotation.z = Math.PI / 4;
        rocket.position.y += 1;
        forward();
    }

    if (keyboard[40]) {
        //down key
        rocket.rotation.z = -Math.PI / 4;
        rocket.position.y -= 1;
        forward();
    }

    if (keyboard[37]) {
        //left key
        rocket.position.x -= 1;
    }

    if (keyboard[39]) {
        //right key
        rocket.position.x += 1;
    }

    animateParticles();
    requestAnimationFrame(animate);
    renderer.render(scene, camera);
};

var createParticleSystem = function createParticleSystem() {
    var particleCount = 2000;
    var particles = new THREE.Geometry();

    for (var i = 0; i < particleCount; i++) {
        var x = Math.random() * 400 - 200;
        var y = Math.random() * 400 - 200;
        var z = Math.random() * 400 - 400;

        var particle = new THREE.Vector3(x, y, z);
        particles.vertices.push(particle);
    }

    var particlesMat = new THREE.PointsMaterial({
        color: 0xffffff,
        size: 4,
        map: new THREE.TextureLoader().load('../assets/img/star.png'),
        blending: THREE.AdditiveBlending,
        transparent: true
    });

    particleSystem = new THREE.Points(particles, particlesMat);
    return particleSystem;
};

var animateParticles = function animateParticles() {
    var verts = particleSystem.geometry.vertices;
    for (var i in verts) {
        var vert = verts[i];
        if (vert.x < -250) {
            vert.y = Math.random() * 400 - 200;
            vert.x = 200;
        }
        vert.x = vert.x - 10 * deltaTime;
        particleSystem.geometry.verticesNeedUpdate = true;
    }
    // particleSystem.rotation.z -= .1 * deltaTime;
};

var onResize = function onResize() {
    width = window.innerWidth;
    height = window.innerHeight;

    camera.aspect = width / height;
    camera.updateProjectionMatrix();
    renderer.setSize(width, height);
    renderer.render(scene, camera);
};
//
// const Rocket = function() {
//     this.mesh = new THREE.Object3D();
//
//     const headGeom = new THREE.CylinderGeometry(0, 5, 10, 500);
//     const headMat = new THREE.MeshPhongMaterial({
//         color: 0xff5511,
//         shading: THREE.FlatShading
//     });
//     const head = new THREE.Mesh(headGeom, headMat);
//     head.position.x = 15;
//     head.rotation.z = -Math.PI / 2;
//     head.castShadow = true;
//     head.receiveShadow = true;
//     this.mesh.add(head);
//
//     const bodyGeom = new THREE.CylinderGeometry(5, 5, 20, 500);
//     const bodyMat = new THREE.MeshPhongMaterial({
//         color: 0xffffff,
//         shading: THREE.FlatShading
//     });
//     const body = new THREE.Mesh(bodyGeom, bodyMat);
//     body.rotation.z = -Math.PI / 2;
//     body.castShadow = true;
//     body.receiveShadow = true;
//     this.mesh.add(body);
//
//     const propellerGeom = new THREE.CylinderGeometry(5, 3, 4, 500);
//     const propellerMat = new THREE.MeshPhongMaterial({
//         color: 0xdddddd,
//         shading: THREE.FlatShading
//     });
//     const propeller = new THREE.Mesh(propellerGeom, propellerMat);
//     propeller.position.x = -10;
//     propeller.rotation.z = -Math.PI / 2;
//     propeller.castShadow = true;
//     propeller.receiveShadow = true;
//     this.mesh.add(propeller);
//
//
//
// };

var createRocket = function createRocket() {
    // rocket = new Rocket();
    // rocket.mesh.position.x = -10;
    // scene.add(rocket.mesh)
};

var keyDown = function keyDown(e) {
    keyboard[e.keyCode] = true;
};

var keyUp = function keyUp(e) {
    keyboard[e.keyCode] = false;
};

window.addEventListener('keydown', keyDown);
window.addEventListener('keyup', keyUp);

window.onload = init();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFsbC5qcyJdLCJuYW1lcyI6WyJzY2VuZSIsImNhbWVyYSIsInJlbmRlcmVyIiwiY2xvY2siLCJkZWx0YVRpbWUiLCJsaWdodCIsInBhcnRpY2xlU3lzdGVtIiwicm9ja2V0Iiwid2lkdGgiLCJoZWlnaHQiLCJrZXlib2FyZCIsImluaXQiLCJ3aW5kb3ciLCJhZGRFdmVudExpc3RlbmVyIiwib25SZXNpemUiLCJUSFJFRSIsIkNsb2NrIiwiU2NlbmUiLCJXZWJHTFJlbmRlcmVyIiwiaW5uZXJXaWR0aCIsImlubmVySGVpZ2h0Iiwic2V0U2l6ZSIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJhcHBlbmRDaGlsZCIsImRvbUVsZW1lbnQiLCJQZXJzcGVjdGl2ZUNhbWVyYSIsInBvc2l0aW9uIiwieiIsIkRpcmVjdGlvbmFsTGlnaHQiLCJzZXQiLCJhZGQiLCJjcmVhdGVQYXJ0aWNsZVN5c3RlbSIsIm10bExvYWRlciIsIk1UTExvYWRlciIsImxvYWQiLCJtYXQiLCJwcmVsb2FkIiwib2JqTG9hZGVyIiwiT0JKTG9hZGVyIiwic2V0TWF0ZXJpYWxzIiwibWVzaCIsIk9iamVjdDNEIiwicGlsb3QiLCJNZXNoIiwiQ2lyY2xlR2VvbWV0cnkiLCJNZXNoQmFzaWNNYXRlcmlhbCIsIm1hcCIsIlRleHR1cmVMb2FkZXIiLCJ5IiwieCIsInNjYWxlIiwicm90YXRpb24iLCJNYXRoIiwiUEkiLCJhbmltYXRlIiwiZm9yd2FyZCIsInJlcXVlc3RBbmltYXRpb25GcmFtZSIsImdldERlbHRhIiwiYW5pbWF0ZVBhcnRpY2xlcyIsInJlbmRlciIsInBhcnRpY2xlQ291bnQiLCJwYXJ0aWNsZXMiLCJHZW9tZXRyeSIsImkiLCJyYW5kb20iLCJwYXJ0aWNsZSIsIlZlY3RvcjMiLCJ2ZXJ0aWNlcyIsInB1c2giLCJwYXJ0aWNsZXNNYXQiLCJQb2ludHNNYXRlcmlhbCIsImNvbG9yIiwic2l6ZSIsImJsZW5kaW5nIiwiQWRkaXRpdmVCbGVuZGluZyIsInRyYW5zcGFyZW50IiwiUG9pbnRzIiwidmVydHMiLCJnZW9tZXRyeSIsInZlcnQiLCJ2ZXJ0aWNlc05lZWRVcGRhdGUiLCJhc3BlY3QiLCJ1cGRhdGVQcm9qZWN0aW9uTWF0cml4IiwiY3JlYXRlUm9ja2V0Iiwia2V5RG93biIsImUiLCJrZXlDb2RlIiwia2V5VXAiLCJvbmxvYWQiXSwibWFwcGluZ3MiOiI7O0FBQUEsSUFBSUEsY0FBSjtBQUFBLElBQ0lDLGVBREo7QUFBQSxJQUVJQyxpQkFGSjtBQUFBLElBR0lDLGNBSEo7QUFBQSxJQUlJQyxrQkFKSjtBQUFBLElBS0lDLGNBTEo7QUFBQSxJQU1JQyx1QkFOSjtBQUFBLElBT0lDLGVBUEo7O0FBU0EsSUFBSUMsY0FBSjtBQUFBLElBQ0lDLGVBREo7O0FBR0EsSUFBSUMsV0FBVyxFQUFmOztBQUlBLElBQU1DLE9BQU8sU0FBUEEsSUFBTyxHQUFNO0FBQ2ZDLFdBQU9DLGdCQUFQLENBQXdCLFFBQXhCLEVBQWtDQyxRQUFsQyxFQUE0QyxLQUE1Qzs7QUFFQVgsWUFBUSxJQUFJWSxNQUFNQyxLQUFWLENBQWdCLElBQWhCLENBQVI7QUFDQWhCLFlBQVEsSUFBSWUsTUFBTUUsS0FBVixFQUFSO0FBQ0FmLGVBQVcsSUFBSWEsTUFBTUcsYUFBVixFQUFYOztBQUVBVixZQUFRSSxPQUFPTyxVQUFmO0FBQ0FWLGFBQVNHLE9BQU9RLFdBQWhCOztBQUVBbEIsYUFBU21CLE9BQVQsQ0FBaUJiLEtBQWpCLEVBQXdCQyxNQUF4Qjs7QUFFQWEsYUFBU0MsY0FBVCxDQUF3QixLQUF4QixFQUErQkMsV0FBL0IsQ0FBMkN0QixTQUFTdUIsVUFBcEQ7QUFDQXhCLGFBQVMsSUFBSWMsTUFBTVcsaUJBQVYsQ0FBNEIsRUFBNUIsRUFBZ0NsQixRQUFRQyxNQUF4QyxFQUFnRCxDQUFoRCxFQUFtRCxJQUFuRCxDQUFUO0FBQ0FSLFdBQU8wQixRQUFQLENBQWdCQyxDQUFoQixHQUFvQixHQUFwQjs7QUFFQXZCLFlBQVEsSUFBSVUsTUFBTWMsZ0JBQVYsQ0FBMkIsUUFBM0IsQ0FBUjtBQUNBeEIsVUFB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QUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsSUFBTW1GLGVBQWUsU0FBZkEsWUFBZSxHQUFNO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNILENBSkQ7O0FBTUEsSUFBTUMsVUFBVSxTQUFWQSxPQUFVLENBQUNDLENBQUQsRUFBTztBQUNuQjVFLGFBQVM0RSxFQUFFQyxPQUFYLElBQXNCLElBQXRCO0FBQ0gsQ0FGRDs7QUFJQSxJQUFNQyxRQUFRLFNBQVJBLEtBQVEsQ0FBQ0YsQ0FBRCxFQUFPO0FBQ2pCNUUsYUFBUzRFLEVBQUVDLE9BQVgsSUFBc0IsS0FBdEI7QUFDSCxDQUZEOztBQUtBM0UsT0FBT0MsZ0JBQVAsQ0FBd0IsU0FBeEIsRUFBbUN3RSxPQUFuQztBQUNBekUsT0FBT0MsZ0JBQVAsQ0FBd0IsT0FBeEIsRUFBaUMyRSxLQUFqQzs7QUFFQTVFLE9BQU82RSxNQUFQLEdBQWdCOUUsTUFBaEIiLCJmaWxlIjoiYWxsLmpzIiwic291cmNlc0NvbnRlbnQiOlsibGV0IHNjZW5lLFxyXG4gICAgY2FtZXJhLFxyXG4gICAgcmVuZGVyZXIsXHJcbiAgICBjbG9jayxcclxuICAgIGRlbHRhVGltZSxcclxuICAgIGxpZ2h0LFxyXG4gICAgcGFydGljbGVTeXN0ZW0sXHJcbiAgICByb2NrZXRcclxuXHJcbmxldCB3aWR0aCxcclxuICAgIGhlaWdodDtcclxuXHJcbmxldCBrZXlib2FyZCA9IHt9O1xyXG5cclxuXHJcblxyXG5jb25zdCBpbml0ID0gKCkgPT4ge1xyXG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIG9uUmVzaXplLCBmYWxzZSk7XHJcblxyXG4gICAgY2xvY2sgPSBuZXcgVEhSRUUuQ2xvY2sodHJ1ZSk7XHJcbiAgICBzY2VuZSA9IG5ldyBUSFJFRS5TY2VuZSgpO1xyXG4gICAgcmVuZGVyZXIgPSBuZXcgVEhSRUUuV2ViR0xSZW5kZXJlcigpO1xyXG5cclxuICAgIHdpZHRoID0gd2luZG93LmlubmVyV2lkdGg7XHJcbiAgICBoZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQ7XHJcblxyXG4gICAgcmVuZGVyZXIuc2V0U2l6ZSh3aWR0aCwgaGVpZ2h0KTtcclxuXHJcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFwJykuYXBwZW5kQ2hpbGQocmVuZGVyZXIuZG9tRWxlbWVudCk7XHJcbiAgICBjYW1lcmEgPSBuZXcgVEhSRUUuUGVyc3BlY3RpdmVDYW1lcmEoNzAsIHdpZHRoIC8gaGVpZ2h0LCAxLCAxMDAwKTtcclxuICAgIGNhbWVyYS5wb3NpdGlvbi56ID0gMTAwO1xyXG5cclxuICAgIGxpZ2h0ID0gbmV3IFRIUkVFLkRpcmVjdGlvbmFsTGlnaHQoMHhmZmZmZmYpO1xyXG4gICAgbGlnaHQucG9zaXRpb24uc2V0KDAsIDAsIDEpO1xyXG4gICAgc2NlbmUuYWRkKGxpZ2h0KTtcclxuXHJcbiAgICBwYXJ0aWNsZVN5c3RlbSA9IGNyZWF0ZVBhcnRpY2xlU3lzdGVtKCk7XHJcbiAgICBzY2VuZS5hZGQocGFydGljbGVTeXN0ZW0pO1xyXG5cclxuXHJcbiAgICBjb25zdCBtdGxMb2FkZXIgPSBuZXcgVEhSRUUuTVRMTG9hZGVyKCk7XHJcblxyXG4gICAgbXRsTG9hZGVyLmxvYWQoJy4uL2Fzc2V0cy9vYmovcm9ja2V0LWxhdW5jaGVyLm10bCcsIChtYXQpID0+IHtcclxuICAgICAgICBtYXQucHJlbG9hZCgpO1xyXG4gICAgICAgIGNvbnN0IG9iakxvYWRlciA9IG5ldyBUSFJFRS5PQkpMb2FkZXIoKTtcclxuXHJcbiAgICAgICAgb2JqTG9hZGVyLnNldE1hdGVyaWFscyhtYXQpO1xyXG4gICAgICAgIG9iakxvYWRlci5sb2FkKCcuLi9hc3NldHMvb2JqL3JvY2tldC1sYXVuY2hlci5vYmonLCAobWVzaCkgPT4ge1xyXG4gICAgICAgICAgICByb2NrZXQgPSBuZXcgVEhSRUUuT2JqZWN0M0QoKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHBpbG90ID0gbmV3IFRIUkVFLk1lc2goXHJcbiAgICAgICAgICAgICAgICBuZXcgVEhSRUUuQ2lyY2xlR2VvbWV0cnkoNSwgMzIpLFxyXG4gICAgICAgICAgICAgICAgbmV3IFRIUkVFLk1lc2hCYXNpY01hdGVyaWFsKHtcclxuICAgICAgICAgICAgICAgICAgICBtYXA6IG5ldyBUSFJFRS5UZXh0dXJlTG9hZGVyKCkubG9hZCgnLi4vYXNzZXRzL2ltZy9vcmVvLnBuZycpXHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgICAgICBwaWxvdC5wb3NpdGlvbi55ID0gMTU7XHJcbiAgICAgICAgICAgIHBpbG90LnBvc2l0aW9uLnggPSAtNTtcclxuICAgICAgICAgICAgbWVzaC5zY2FsZS5zZXQoMTAsIDEwLCAxMCk7XHJcbiAgICAgICAgICAgIG1lc2gucm90YXRpb24ueiA9IE1hdGguUEkgLyAyO1xyXG4gICAgICAgICAgICBtZXNoLnJvdGF0aW9uLnkgPSBNYXRoLlBJO1xyXG4gICAgICAgICAgICByb2NrZXQuYWRkKHBpbG90KTtcclxuICAgICAgICAgICAgcm9ja2V0LmFkZChtZXNoKTtcclxuICAgICAgICAgICAgc2NlbmUuYWRkKHJvY2tldCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcblxyXG4gICAgLy8gY3JlYXRlUm9ja2V0KCk7XHJcbiAgICBhbmltYXRlKCk7XHJcblxyXG59O1xyXG5cclxuY29uc3QgZm9yd2FyZCA9ICgpID0+IHtcclxuICAgIGlmIChyb2NrZXQucm90YXRpb24ueiAhPT0gMCkge1xyXG4gICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShmb3J3YXJkKTtcclxuICAgICAgICBpZiAocm9ja2V0LnJvdGF0aW9uLnogPiAwKSB7XHJcbiAgICAgICAgICAgIHJvY2tldC5yb3RhdGlvbi56IC09IE1hdGguUEkgLyAxNjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChyb2NrZXQucm90YXRpb24ueiA8IDApIHtcclxuICAgICAgICAgICAgcm9ja2V0LnJvdGF0aW9uLnogKz0gTWF0aC5QSSAvIDE2O1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbn07XHJcblxyXG5jb25zdCBhbmltYXRlID0gKCkgPT4ge1xyXG4gICAgZGVsdGFUaW1lID0gY2xvY2suZ2V0RGVsdGEoKTtcclxuXHJcbiAgICAvLyBjb250cm9sIHJvY2tldFxyXG5cclxuICAgIGlmIChrZXlib2FyZFszOF0pIHsgLy91cCBrZXlcclxuICAgICAgICByb2NrZXQucm90YXRpb24ueiA9IE1hdGguUEkgLyA0O1xyXG4gICAgICAgIHJvY2tldC5wb3NpdGlvbi55ICs9IDE7XHJcbiAgICAgICAgZm9yd2FyZCgpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChrZXlib2FyZFs0MF0pIHsgLy9kb3duIGtleVxyXG4gICAgICAgIHJvY2tldC5yb3RhdGlvbi56ID0gLU1hdGguUEkgLyA0O1xyXG4gICAgICAgIHJvY2tldC5wb3NpdGlvbi55IC09IDE7XHJcbiAgICAgICAgZm9yd2FyZCgpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChrZXlib2FyZFszN10pIHsgLy9sZWZ0IGtleVxyXG4gICAgICAgIHJvY2tldC5wb3NpdGlvbi54IC09IDE7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKGtleWJvYXJkWzM5XSkgeyAvL3JpZ2h0IGtleVxyXG4gICAgICAgIHJvY2tldC5wb3NpdGlvbi54ICs9IDE7XHJcbiAgICB9XHJcblxyXG4gICAgYW5pbWF0ZVBhcnRpY2xlcygpO1xyXG4gICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGUpO1xyXG4gICAgcmVuZGVyZXIucmVuZGVyKHNjZW5lLCBjYW1lcmEpXHJcbn07XHJcblxyXG5jb25zdCBjcmVhdGVQYXJ0aWNsZVN5c3RlbSA9ICgpID0+IHtcclxuICAgIGNvbnN0IHBhcnRpY2xlQ291bnQgPSAyMDAwO1xyXG4gICAgY29uc3QgcGFydGljbGVzID0gbmV3IFRIUkVFLkdlb21ldHJ5KCk7XHJcblxyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwYXJ0aWNsZUNvdW50OyBpKyspIHtcclxuICAgICAgICBsZXQgeCA9IE1hdGgucmFuZG9tKCkgKiA0MDAgLSAyMDA7XHJcbiAgICAgICAgbGV0IHkgPSBNYXRoLnJhbmRvbSgpICogNDAwIC0gMjAwO1xyXG4gICAgICAgIGxldCB6ID0gTWF0aC5yYW5kb20oKSAqIDQwMCAtIDQwMDtcclxuXHJcbiAgICAgICAgbGV0IHBhcnRpY2xlID0gbmV3IFRIUkVFLlZlY3RvcjMoeCwgeSwgeik7XHJcbiAgICAgICAgcGFydGljbGVzLnZlcnRpY2VzLnB1c2gocGFydGljbGUpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHBhcnRpY2xlc01hdCA9IG5ldyBUSFJFRS5Qb2ludHNNYXRlcmlhbCh7XHJcbiAgICAgICAgY29sb3I6IDB4ZmZmZmZmLFxyXG4gICAgICAgIHNpemU6IDQsXHJcbiAgICAgICAgbWFwOiBuZXcgVEhSRUUuVGV4dHVyZUxvYWRlcigpLmxvYWQoJy4uL2Fzc2V0cy9pbWcvc3Rhci5wbmcnKSxcclxuICAgICAgICBibGVuZGluZzogVEhSRUUuQWRkaXRpdmVCbGVuZGluZyxcclxuICAgICAgICB0cmFuc3BhcmVudDogdHJ1ZVxyXG4gICAgfSk7XHJcblxyXG4gICAgcGFydGljbGVTeXN0ZW0gPSBuZXcgVEhSRUUuUG9pbnRzKHBhcnRpY2xlcywgcGFydGljbGVzTWF0KTtcclxuICAgIHJldHVybiBwYXJ0aWNsZVN5c3RlbTtcclxufTtcclxuXHJcbmNvbnN0IGFuaW1hdGVQYXJ0aWNsZXMgPSAoKSA9PiB7XHJcbiAgICBjb25zdCB2ZXJ0cyA9IHBhcnRpY2xlU3lzdGVtLmdlb21ldHJ5LnZlcnRpY2VzO1xyXG4gICAgZm9yIChsZXQgaSBpbiB2ZXJ0cykge1xyXG4gICAgICAgIGxldCB2ZXJ0ID0gdmVydHNbaV07XHJcbiAgICAgICAgaWYgKHZlcnQueCA8IC0yNTApIHtcclxuICAgICAgICAgICAgdmVydC55ID0gTWF0aC5yYW5kb20oKSAqIDQwMCAtIDIwMDtcclxuICAgICAgICAgICAgdmVydC54ID0gMjAwO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2ZXJ0LnggPSB2ZXJ0LnggLSAoMTAgKiBkZWx0YVRpbWUpO1xyXG4gICAgICAgIHBhcnRpY2xlU3lzdGVtLmdlb21ldHJ5LnZlcnRpY2VzTmVlZFVwZGF0ZSA9IHRydWU7XHJcbiAgICB9XHJcbiAgICAvLyBwYXJ0aWNsZVN5c3RlbS5yb3RhdGlvbi56IC09IC4xICogZGVsdGFUaW1lO1xyXG59O1xyXG5cclxuY29uc3Qgb25SZXNpemUgPSAoKSA9PiB7XHJcbiAgICB3aWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoO1xyXG4gICAgaGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0O1xyXG5cclxuICAgIGNhbWVyYS5hc3BlY3QgPSB3aWR0aCAvIGhlaWdodDtcclxuICAgIGNhbWVyYS51cGRhdGVQcm9qZWN0aW9uTWF0cml4KCk7XHJcbiAgICByZW5kZXJlci5zZXRTaXplKHdpZHRoLCBoZWlnaHQpO1xyXG4gICAgcmVuZGVyZXIucmVuZGVyKHNjZW5lLCBjYW1lcmEpO1xyXG59O1xyXG4vL1xyXG4vLyBjb25zdCBSb2NrZXQgPSBmdW5jdGlvbigpIHtcclxuLy8gICAgIHRoaXMubWVzaCA9IG5ldyBUSFJFRS5PYmplY3QzRCgpO1xyXG4vL1xyXG4vLyAgICAgY29uc3QgaGVhZEdlb20gPSBuZXcgVEhSRUUuQ3lsaW5kZXJHZW9tZXRyeSgwLCA1LCAxMCwgNTAwKTtcclxuLy8gICAgIGNvbnN0IGhlYWRNYXQgPSBuZXcgVEhSRUUuTWVzaFBob25nTWF0ZXJpYWwoe1xyXG4vLyAgICAgICAgIGNvbG9yOiAweGZmNTUxMSxcclxuLy8gICAgICAgICBzaGFkaW5nOiBUSFJFRS5GbGF0U2hhZGluZ1xyXG4vLyAgICAgfSk7XHJcbi8vICAgICBjb25zdCBoZWFkID0gbmV3IFRIUkVFLk1lc2goaGVhZEdlb20sIGhlYWRNYXQpO1xyXG4vLyAgICAgaGVhZC5wb3NpdGlvbi54ID0gMTU7XHJcbi8vICAgICBoZWFkLnJvdGF0aW9uLnogPSAtTWF0aC5QSSAvIDI7XHJcbi8vICAgICBoZWFkLmNhc3RTaGFkb3cgPSB0cnVlO1xyXG4vLyAgICAgaGVhZC5yZWNlaXZlU2hhZG93ID0gdHJ1ZTtcclxuLy8gICAgIHRoaXMubWVzaC5hZGQoaGVhZCk7XHJcbi8vXHJcbi8vICAgICBjb25zdCBib2R5R2VvbSA9IG5ldyBUSFJFRS5DeWxpbmRlckdlb21ldHJ5KDUsIDUsIDIwLCA1MDApO1xyXG4vLyAgICAgY29uc3QgYm9keU1hdCA9IG5ldyBUSFJFRS5NZXNoUGhvbmdNYXRlcmlhbCh7XHJcbi8vICAgICAgICAgY29sb3I6IDB4ZmZmZmZmLFxyXG4vLyAgICAgICAgIHNoYWRpbmc6IFRIUkVFLkZsYXRTaGFkaW5nXHJcbi8vICAgICB9KTtcclxuLy8gICAgIGNvbnN0IGJvZHkgPSBuZXcgVEhSRUUuTWVzaChib2R5R2VvbSwgYm9keU1hdCk7XHJcbi8vICAgICBib2R5LnJvdGF0aW9uLnogPSAtTWF0aC5QSSAvIDI7XHJcbi8vICAgICBib2R5LmNhc3RTaGFkb3cgPSB0cnVlO1xyXG4vLyAgICAgYm9keS5yZWNlaXZlU2hhZG93ID0gdHJ1ZTtcclxuLy8gICAgIHRoaXMubWVzaC5hZGQoYm9keSk7XHJcbi8vXHJcbi8vICAgICBjb25zdCBwcm9wZWxsZXJHZW9tID0gbmV3IFRIUkVFLkN5bGluZGVyR2VvbWV0cnkoNSwgMywgNCwgNTAwKTtcclxuLy8gICAgIGNvbnN0IHByb3BlbGxlck1hdCA9IG5ldyBUSFJFRS5NZXNoUGhvbmdNYXRlcmlhbCh7XHJcbi8vICAgICAgICAgY29sb3I6IDB4ZGRkZGRkLFxyXG4vLyAgICAgICAgIHNoYWRpbmc6IFRIUkVFLkZsYXRTaGFkaW5nXHJcbi8vICAgICB9KTtcclxuLy8gICAgIGNvbnN0IHByb3BlbGxlciA9IG5ldyBUSFJFRS5NZXNoKHByb3BlbGxlckdlb20sIHByb3BlbGxlck1hdCk7XHJcbi8vICAgICBwcm9wZWxsZXIucG9zaXRpb24ueCA9IC0xMDtcclxuLy8gICAgIHByb3BlbGxlci5yb3RhdGlvbi56ID0gLU1hdGguUEkgLyAyO1xyXG4vLyAgICAgcHJvcGVsbGVyLmNhc3RTaGFkb3cgPSB0cnVlO1xyXG4vLyAgICAgcHJvcGVsbGVyLnJlY2VpdmVTaGFkb3cgPSB0cnVlO1xyXG4vLyAgICAgdGhpcy5tZXNoLmFkZChwcm9wZWxsZXIpO1xyXG4vL1xyXG4vL1xyXG4vL1xyXG4vLyB9O1xyXG5cclxuY29uc3QgY3JlYXRlUm9ja2V0ID0gKCkgPT4ge1xyXG4gICAgLy8gcm9ja2V0ID0gbmV3IFJvY2tldCgpO1xyXG4gICAgLy8gcm9ja2V0Lm1lc2gucG9zaXRpb24ueCA9IC0xMDtcclxuICAgIC8vIHNjZW5lLmFkZChyb2NrZXQubWVzaClcclxufTtcclxuXHJcbmNvbnN0IGtleURvd24gPSAoZSkgPT4ge1xyXG4gICAga2V5Ym9hcmRbZS5rZXlDb2RlXSA9IHRydWU7XHJcbn07XHJcblxyXG5jb25zdCBrZXlVcCA9IChlKSA9PiB7XHJcbiAgICBrZXlib2FyZFtlLmtleUNvZGVdID0gZmFsc2U7XHJcbn07XHJcblxyXG5cclxud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBrZXlEb3duKTtcclxud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywga2V5VXApO1xyXG5cclxud2luZG93Lm9ubG9hZCA9IGluaXQoKTsiXX0=
